{"CLs":[{"__type":"LD","Var":"P_First_Run"},{"__type":"IST","EID":"ef80504a-c0ad-45f7-9a22-d3af5d6e8ec1","H":254.00000000000011,"Ix":1,"TXT":"FB_MQTTClient.Host:='192.168.1.33';\u000d\u000aFB_MQTTClient.ServerPort:=1883;\u000d\u000aFB_MQTTClient.ClientID:='NX1P2';\u000d\u000aFB_MQTTClient.KeepAlive:=60;\u000d\u000aFB_MQTTClient.CleanSession:=TRUE;\u000d\u000a\/\/FB_MQTTClient.WillConfig.WillTopic:='NX1P2Status\\';\u000d\u000a\/\/FB_MQTTClient.WillConfig.WillMsg := 'Disconnected';\u000d\u000a\/\/FB_MQTTClient.WillConfig.WillFlag := TRUE;\u000d\u000aUserLogin.User:='Franck';\u000d\u000aUserLogin.Password:='}VG$']Hw*9EDYBAz';\u000d\u000a","W":568.8,"X":1}],"CMT":"Configuration de la connexion","LRI":2,"RRI":3,"VLs":[]}
{"CLs":[{"__type":"IST","EID":"c31481a2-ee60-4145-962e-6a5d67b9d326","H":414.80000000000013,"TXT":"\/\/ Temps avant reconnexion\u000d\u000aReconnectionDelay(In := Reconnect, PT := T#5s); \u000d\u000a\/\/ Temps avant de voir si le broker est présent\u000d\u000aWaitDelay(In := Wait, PT := T#10s);\u000d\u000a\u000d\u000a\/\/ Séquence de reconnexion\u000d\u000aIF NOT BrokerConnected AND NOT InitConnection THEN\u000d\u000a\u0009InitConnection := TRUE;\u000d\u000a\u0009BrokerConnect := FALSE;\u000d\u000a\u0009Wait := FALSE;\u000d\u000a\u0009Reconnect := FALSE;\u000d\u000a\u0009State := 10;\u000d\u000aEND_IF;\u000d\u000a\u000d\u000aCASE State OF\u000d\u000a\u0009\u000d\u000a\u000910: \/\/ Compteur de reconnexions\u000d\u000a\u0009\u0009Inc(ReconnectCounter);\u000d\u000a\u0009\u0009State := 20;\u000d\u000a\u0009\u0009\u000d\u000a\u000920: \/\/ Temps d'attente avant reconnexion\u000d\u000a\u0009\u0009Reconnect :=  TRUE;\u000d\u000a\u0009\u0009\u000d\u000a\u0009\u0009IF ReconnectionDelay.Q THEN\u000d\u000a\u0009\u0009\u0009BrokerConnect := TRUE;\u000d\u000a\u0009\u0009\u0009Reconnect := FALSE;\u000d\u000a\u0009\u0009\u0009State := 30;\u000d\u000a\u0009\u0009END_IF;\u000d\u000a\u0009\u0009\u000d\u000a\u000930: \/\/ Temps d'attente avant de voir si le broker est connecté\u000d\u000a\u0009\u0009Wait := TRUE;\u000d\u000a\u0009\u0009\u000d\u000a\u0009\u0009IF WaitDelay.Q AND BrokerConnected THEN\u000d\u000a\u0009\u0009\u0009\/\/ Connexion OK\u000d\u000a\u0009\u0009\u0009Wait := FALSE;\u000d\u000a\u0009\u0009\u0009Reconnect := FALSE;\u000d\u000a\u0009\u0009\u0009InitConnection := FALSE;\u000d\u000a\u0009\u0009\u0009State := 0;\u000d\u000a\u0009\u0009ELSIF WaitDelay.Q AND NOT BrokerConnected THEN\u000d\u000a\u0009\u0009\u0009Wait := FALSE;\u000d\u000a\u0009\u0009\u0009Reconnect := FALSE;\u000d\u000a\u0009\u0009\u0009BrokerConnect := FALSE;\u000d\u000a\u0009\u0009\u0009State := 10;\u000d\u000a\u0009\u0009END_IF;\u000d\u000aEND_CASE;\u0009\u0009\u000d\u000a","W":639.2}],"CMT":"Tentatives de connexions","LRI":1,"RRI":2,"VLs":[]}
{"CLs":[{"__type":"LD","Var":"BrokerConnect"},{"__type":"FB","In":[{"__type":"PF","Arg":"Enable"},{"__type":"PRM","Arg":"Host","Ix":2,"Type":"STRING[256]","Var":""},{"__type":"PRM","Arg":"ServerPort","Ix":3,"Type":"UINT","Var":""},{"__type":"PRM","Arg":"ClientID","Ix":4,"Type":"STRING[128]","Var":""},{"__type":"PRM","Arg":"KeepAlive","Ix":5,"Type":"UINT","Var":""},{"__type":"PRM","Arg":"CleanSession","Ix":6,"Type":"BOOL","Var":""},{"__type":"PRM","Arg":"WillConfig","Ix":7,"Type":"MQTT\\WillCnfg","Var":""},{"__type":"PRM","Arg":"UserLogin","Ix":8,"Type":"MQTT\\Login","Var":"UserLogin"},{"__type":"PRM","Arg":"BufferIn","IO":true,"Ix":9,"Type":"MQTT\\ClientBuffer","Var":"BufferIn"}],"Ix":16,"Name":"\\\\MQTT\\MQTTClient","Out":[{"__type":"PF","Arg":"Connected"},{"__type":"PRM","Arg":"Busy","Ix":10,"Type":"BOOL","Var":"FB_MQTTClient_Busy"},{"__type":"PRM","Arg":"SocketID","Ix":11,"Type":"_sSOCKET","Var":"FB_MQTTClient_SocketID"},{"__type":"PRM","Arg":"Error","Ix":12,"Type":"BOOL","Var":"FB_MQTTClient_Error"},{"__type":"PRM","Arg":"ErrorID","Ix":13,"Type":"WORD","Var":"FB_MQTTClient_ErrorID"},{"__type":"PRM","Arg":"ErrorIDEx","Ix":14,"Type":"DWORD","Var":"FB_MQTTClient_ErrorIDEx"},{"__type":"PRM","Arg":"BufferIn","IO":true,"Ix":15,"Type":"MQTT\\ClientBuffer","Var":"BufferIn"}],"UD":true,"X":1,"Var":"FB_MQTTClient"},{"__type":"ST","Ix":1,"Var":"BrokerConnected","X":2}],"CMT":"Connexion","LRI":17,"RRI":18,"VLs":[]}
{"CLs":[{"__type":"LD","Var":"BrokerConnected"},{"__type":"FB","In":[{"__type":"PF","Arg":"Enable"},{"__type":"PRM","Arg":"Buffer","IO":true,"Ix":2,"Type":"MQTT\\ClientBuffer","Var":"BufferIn"},{"__type":"PRM","Arg":"PingTime","Ix":3,"Type":"UINT","Var":"30000"},{"__type":"PRM","Arg":"TimeOut","Ix":4,"Type":"UINT","Var":"5000"}],"Ix":12,"Name":"\\\\MQTT\\MQTTPing","Out":[{"__type":"PF","Arg":"PingStatus"},{"__type":"PRM","Arg":"Buffer","IO":true,"Ix":5,"Type":"MQTT\\ClientBuffer","Var":"BufferIn"},{"__type":"PRM","Arg":"Response","Ix":6,"Type":"UINT","Var":"FB_MQTTPing_ResponseTime"},{"__type":"PRM","Arg":"Busy","Ix":7,"Type":"BOOL","Var":"FB_MQTTPing_Busy"},{"__type":"PRM","Arg":"PingRESP","Ix":8,"Type":"BOOL","Var":"FB_MQTTPing_PingRESP"},{"__type":"PRM","Arg":"Error","Ix":9,"Type":"BOOL","Var":"FB_MQTTPing_Error"},{"__type":"PRM","Arg":"ErrorID","Ix":10,"Type":"WORD","Var":"FB_MQTTPing_ErrorID"},{"__type":"PRM","Arg":"ErrorIDEx","Ix":11,"Type":"DWORD","Var":"FB_MQTTPing_ErrorIDEx"}],"UD":true,"X":1,"Var":"FB_MQTTPing"},{"__type":"ST","Ix":1,"Var":"BrokerAlive","X":2}],"CMT":"Vérifie périodiquement si la liaison est active","LRI":13,"RRI":14,"VLs":[]}
{"CLs":[{"__type":"LD","Var":"BrokerConnected"},{"__type":"LD","Ix":1,"Var":"P_Off","X":1},{"__type":"FB","In":[{"__type":"PF","Arg":"Enable"},{"__type":"PRM","Arg":"Topic","Ix":2,"Type":"STRING[128]","Var":"'zigbee2mqtt\/Aqara_sensor1'"},{"__type":"PRM","Arg":"QoS","Ix":3,"Type":"BYTE","Var":"0"},{"__type":"PRM","Arg":"Message","IO":true,"Ix":4,"Type":"STRING[1986]","Var":"strAqara_sensor1"},{"__type":"PRM","Arg":"Buffer","IO":true,"Ix":5,"Type":"MQTT\\ClientBuffer","Var":"BufferIn"},{"__type":"PRM","Arg":"RcvTopic","IO":true,"Ix":6,"Type":"STRING[128]","Var":"RcvTopicAqara_sensor1"}],"Ix":17,"Name":"\\\\MQTT\\MQTTSubscribe","Out":[{"__type":"PF","Arg":"Subscribed"},{"__type":"PRM","Arg":"Done","Ix":7,"Type":"BOOL","Var":"FB_MQTTSub_Aqara_sensor1_Done"},{"__type":"PRM","Arg":"Busy","Ix":8,"Type":"BOOL","Var":"FB_MQTTSub_Aqara_sensor1_Busy"},{"__type":"PRM","Arg":"Message","IO":true,"Ix":9,"Type":"STRING[1986]","Var":"strAqara_sensor1"},{"__type":"PRM","Arg":"Buffer","IO":true,"Ix":10,"Type":"MQTT\\ClientBuffer","Var":"BufferIn"},{"__type":"PRM","Arg":"RcvTopic","IO":true,"Ix":11,"Type":"STRING[128]","Var":"RcvTopicAqara_sensor1"},{"__type":"PRM","Arg":"PacketID","Ix":12,"Type":"UINT","Var":"FB_MQTTSub_Aqara_sensor1_PacketID"},{"__type":"PRM","Arg":"Error","Ix":13,"Type":"BOOL","Var":"FB_MQTTSub_Aqara_sensor1_Error"},{"__type":"PRM","Arg":"ErrorID","Ix":14,"Type":"WORD","Var":"FB_MQTTSub_Aqara_sensor1_ErrorID"},{"__type":"PRM","Arg":"ErrorIDEx","Ix":15,"Type":"DWORD","Var":"FB_MQTTSub_Aqara_sensor1_ErrorIDEx"},{"__type":"PRM","Arg":"Size","Ix":16,"Type":"UINT","Var":"FB_MQTTSub_Aqara_sensor1_Size"}],"UD":true,"X":2,"Var":"FB_MQTTSub_Aqara_sensor1"},{"__type":"IST","EID":"f60fd4e5-ec94-4ff4-8136-b773f4d1a26d","H":130,"Ix":18,"TXT":"\/\/ Température (-20 à +50°C)\u000d\u000aTemp_sensor1:=STRING_TO_REAL(MID(strAqara_sensor1,5,FIND(strAqara_sensor1,'temperature')+13));\u000d\u000a\u000d\u000a\/\/ Humidité relative (0 à 100% HR)\u000d\u000aHum_sensor1:=STRING_TO_REAL(MID(strAqara_sensor1,5,FIND(strAqara_sensor1,'humidity')+10));\u000d\u000a\u000d\u000a\/\/ Pression atmosphérique en hPa (300 à 1100 hPa)\u000d\u000aPress_sensor1:=STRING_TO_REAL(MID(strAqara_sensor1,5,FIND(strAqara_sensor1,'pressure')+10));\u000d\u000a\u000d\u000a\/\/ Tension de la pile (mV)\u000d\u000aVolt_sensor1:=STRING_TO_REAL(MID(strAqara_sensor1,4,FIND(strAqara_sensor1,'voltage')+9));\u000d\u000a\u000d\u000a\/\/ Niveau de charge de la pile (0 à 100%)\u000d\u000aBatt_sensor1:=STRING_TO_REAL(MID(strAqara_sensor1,2,FIND(strAqara_sensor1,'battery')+9));\u000d\u000a\u000d\u000a\/\/ Qualité de la connexion (0-255)\u000d\u000aLinkQ_sensor1:=STRING_TO_REAL(MID(strAqara_sensor1,3,FIND(strAqara_sensor1,'linkquality')+13));\u000d\u000a","W":654.4,"X":2,"Y":1}],"CMT":"# Sensor 1\u000d\u000aSouscription au topic","LRI":19,"RRI":20,"VLs":[{"Ix":21,"X":2}]}
