{"CLs":[{"__type":"IST","EID":"f131a888-5559-4bbb-83e2-149ab62777ca","H":913.99999999999977,"TXT":"DtToDateStruct(_CurrentTime,RTC);\u000d\u000a\u000d\u000a\/\/ Top juste après la synchro NTP\u000d\u000aHMIclockSync(Clk:=(RTC.Hour=0 AND RTC.Min=1));\u000d\u000a\u000d\u000aCASE PhaseRTC OF\u000d\u000a    0 : \/\/ Attend le top\u000d\u000a\u0009IF  HMIclockSync.Q THEN\u000d\u000a\u0009\u0009GetNTPStatus(ExecNormal=>NTPexeNormal);\u000d\u000a\u0009\u0009PhaseRTC:=10;\u000d\u000a\u0009END_IF;\u000d\u000a\u0009\u000d\u000a\u000910 : \/\/ Vérifie la synchro NTP\u000d\u000a\u0009IF NTPexeNormal THEN\u000d\u000a\u0009\u0009PhaseRTC:=20;\u000d\u000a\u0009ELSE\u000d\u000a\u0009\u0009\/\/ La synchro NTP a échoué\u000d\u000a\u0009\u0009Inc(RTC_error);\u000d\u000a\u0009\u0009PhaseRTC:=0;\u000d\u000a\u0009END_IF;\u000d\u000a\u0009\u000d\u000a\u000920 : \/\/ Synchro RTC de l'IHM\u000d\u000a\u0009\u0009W[40]:=INT_TO_WORD(RTC.Sec);\u000d\u000a\u0009\u0009W[41]:=INT_TO_WORD(RTC.Min);\u000d\u000a\u0009\u0009W[42]:=INT_TO_WORD(RTC.Hour);\u000d\u000a\u0009\u0009W[43]:=INT_TO_WORD(RTC.Day);\u000d\u000a\u0009\u0009W[44]:=INT_TO_WORD(RTC.Month);\u000d\u000a\u0009\u0009W[45]:=INT_TO_WORD(RTC.Year);\u000d\u000a\u0009\u0009W_bit[3]:=TRUE;\u000d\u000a\u0009\u0009PhaseRTC:=30;\u000d\u000a\u0009\u0009\u000d\u000a\u000930 : \/\/ Attente de l'accusé de réception de l'IHM\u000d\u000a\u0009\u0009TimeoutAck(In:=TRUE,PT:=T#500ms);\u000d\u000a\u0009\u0009IF W_bit[9] THEN\u000d\u000a\u0009\u0009\u0009W_bit[3]:=FALSE;\u000d\u000a\u0009\u0009\u0009W_bit[9]:=FALSE;\u000d\u000a\u0009\u0009\u0009PhaseRTC:=0;\u000d\u000a\u0009\u0009ELSIF TimeoutAck.Q THEN\u000d\u000a\u0009\u0009\u0009TimeoutAck(In:=FALSE,PT:=T#500ms);\u000d\u000a\u0009\u0009\u0009Inc(RTC_error);\u000d\u000a\u0009\u0009\u0009W_bit[3]:=FALSE;\u000d\u000a\u0009\u0009\u0009PhaseRTC:=0;\u000d\u000a\u0009\u0009END_IF;\u000d\u000a\u0009\u0009\u000d\u000aEND_CASE;","W":619.99999999999966}],"CMT":"Synchronisation NTP du contrôleur et du RTC de l'IHM","LRI":1,"RRI":2,"VLs":[]}
